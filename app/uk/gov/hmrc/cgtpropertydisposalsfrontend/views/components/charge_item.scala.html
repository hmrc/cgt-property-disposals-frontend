@*
 * Copyright 2020 HM Revenue & Customs
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *@

@import play.api.i18n.Messages
@import play.twirl.api.Html

@import uk.gov.hmrc.cgtpropertydisposalsfrontend.controllers.returns.routes
@import uk.gov.hmrc.cgtpropertydisposalsfrontend.models.finance.Charge
@import uk.gov.hmrc.cgtpropertydisposalsfrontend.models.TimeUtils
@import uk.gov.hmrc.cgtpropertydisposalsfrontend.models.finance.MoneyUtils

@this()

@(charge: Charge)(implicit messages: Messages)

  <tr class="no-border charge">
    <td>
      <strong class="bold">
        @messages(s"viewReturn.chargeType.${charge.chargeType.toString}")
      </strong>
      <br>
      <span class="caption">
        @{charge.chargeReference}
      </span>
    </td>
    <td>
      @{TimeUtils.govShortDisplayFormat(charge.dueDate)}
    </td>
    <td>
      @{MoneyUtils.formatAmountOfMoneyWithPoundSign(charge.amount.inPounds())}
    </td>
    <td>
      <strong class="bold">
        @{MoneyUtils.formatAmountOfMoneyWithPoundSign(charge.totalOutstanding().inPounds())}
      </strong>
    </td>
    <td>
      @if(charge.totalOutstanding().isZero) {
        @messages("viewReturn.charge.status.paid")
      } else {
        @Html(messages("viewReturn.charge.status.payNow", routes.ViewReturnController.payCharge(charge.chargeReference)))
      }
    </td>
  </tr>

  @if(charge.payments.nonEmpty) {
  <tr>
    <td class="allocations" colspan="5">
      <div class="panel panel-border-wide payments-list-container">
        <ul class="payments-list">
          @{charge.payments.map { payment =>
            <li>
              <strong class="bold">
                {MoneyUtils.formatAmountOfMoneyWithPoundSign(payment.amount.inPounds())}
              </strong>
              {messages(s"viewReturn.charge.paymentMethod.${payment.method.toString}")}
              {messages("generic.on")}
              {TimeUtils.govShortDisplayFormat(payment.clearingDate)}
            </li>
          }}
        </ul>
      </div>
    </td>
  </tr>
  }
