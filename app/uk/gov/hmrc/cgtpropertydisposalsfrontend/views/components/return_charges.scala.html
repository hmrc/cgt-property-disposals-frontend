@*
 * Copyright 2020 HM Revenue & Customs
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *@

@import play.api.i18n.Messages
@import play.twirl.api.Html
@import cats.syntax.eq._
@import uk.gov.hmrc.cgtpropertydisposalsfrontend.models.finance.ChargeType.UkResidentReturn
@import uk.gov.hmrc.cgtpropertydisposalsfrontend.models.finance.ChargeType.NonUkResidentReturn
@import uk.gov.hmrc.cgtpropertydisposalsfrontend.models.returns.ReturnSummary
@import uk.gov.hmrc.cgtpropertydisposalsfrontend.models.TimeUtils

@this(
    chargeItem: uk.gov.hmrc.cgtpropertydisposalsfrontend.views.html.components.charge_item,
    warning: uk.gov.hmrc.cgtpropertydisposalsfrontend.views.html.components.warning,
    notice: uk.gov.hmrc.cgtpropertydisposalsfrontend.views.html.components.inset_panel
)

@(heading: String, key : String, returnSummary: ReturnSummary)(implicit messages: Messages)

    <h2 class="heading-large">@heading</h2>

    @if(returnSummary.isRecentlyAmended){
        @warning(messages(s"${key}.amendment.warning"))
        @notice(Html(messages(s"$key.amendment.notice")))
        <table class="borders payments-table view-return-charges">
            <thead>
            <tr style="vertical-align:bottom;">
                <th scope="col">@messages("viewReturn.charges.description")</th>
                <th scope="col">@messages("viewReturn.charges.payBy")</th>
                <th scope="col">@messages("viewReturn.charges.amount")</th>
                <th scope="col">@messages("viewReturn.charges.due")</th>
                <th scope="col">@messages("viewReturn.charges.status")</th>
            </tr>
            </thead>
            <tbody id="returnPaymentDetails-@returnSummary.submissionId">
                @if(returnSummary.deltaCharge.isDefined){
                    @{ returnSummary.charges.map(chargeItem(_, returnSummary.isRecentlyAmended))} 
                }else{
                    @{ returnSummary.charges.map(chargeItem(_, returnSummary.isRecentlyAmended))}
                }
            </tbody>
        </table>
    }else{
        @returnSummary.charges.filter(c => c.chargeType === UkResidentReturn || c.chargeType === NonUkResidentReturn).map { charge =>
            @warning(messages(s"${key}.warning", TimeUtils.govDisplayFormat(charge.dueDate)))
        }

        @returnSummary.charges.filter(c => c.chargeType === UkResidentReturn || c.chargeType === NonUkResidentReturn).map { _ =>
            @Html(messages(s"${key}.warning.subtext"))
        }
        <table class="borders payments-table view-return-charges">
            <thead>
            <tr style="vertical-align:bottom;">
                <th scope="col">@messages("viewReturn.charges.description")</th>
                <th scope="col">@messages("viewReturn.charges.payBy")</th>
                <th scope="col">@messages("viewReturn.charges.amount")</th>
                <th scope="col">@messages("viewReturn.charges.due")</th>
                <th scope="col">@messages("viewReturn.charges.status")</th>
            </tr>
            </thead>
            <tbody id="returnPaymentDetails-@returnSummary.submissionId">
            @{ returnSummary.charges.map(chargeItem(_, returnSummary.isRecentlyAmended))}
            </tbody>
        </table>
    }