@*
 * Copyright 2020 HM Revenue & Customs
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *@

@import uk.gov.hmrc.cgtpropertydisposalsfrontend.config.ViewConfig
@import uk.gov.hmrc.cgtpropertydisposalsfrontend.controllers
@import uk.gov.hmrc.cgtpropertydisposalsfrontend.models.onboarding.SubscribedDetails
@import uk.gov.hmrc.cgtpropertydisposalsfrontend.models.returns.DraftReturn
@import uk.gov.hmrc.cgtpropertydisposalsfrontend.views.account.AccountMenuItem
@import uk.gov.hmrc.cgtpropertydisposalsfrontend.controllers.actions.RequestWithSessionData
@import uk.gov.hmrc.cgtpropertydisposalsfrontend.models.UserType

@this(
mainTemplate: uk.gov.hmrc.cgtpropertydisposalsfrontend.views.html.main_template,
pageHeading: uk.gov.hmrc.cgtpropertydisposalsfrontend.views.html.components.page_heading,
accountMenu: uk.gov.hmrc.cgtpropertydisposalsfrontend.views.html.components.account_menu,
insetPanel: uk.gov.hmrc.cgtpropertydisposalsfrontend.views.html.components.inset_panel,
buttonLink: uk.gov.hmrc.cgtpropertydisposalsfrontend.views.html.components.button_link
)

@(details: SubscribedDetails, draftReturns: List[DraftReturn],totalLeftToPay:BigDecimal)(implicit request:RequestWithSessionData[_], messages:Messages, appConfig: ViewConfig)

@isAnAgent = @{request.userType.contains(UserType.Agent)}
@title = @{messages(s"account.home.title")}
@subtitle = @{
 if(isAnAgent) messages("account.home.subtitle.agent", details.makeAccountName(), details.cgtReference.value)
 else messages("account.home.subtitle", details.cgtReference.value)
}

@mainTemplate(title = title, userType = request.userType, mainClass=Some("full-width"), withSignOutLink = false, accountMenu=Some(accountMenu(Some(AccountMenuItem.Home())))) {

 @pageHeading(title, Some(messages("account.caption")), Some(subtitle))

 @buttonLink(messages("account.home.button.start-a-new-return"), controllers.accounts.homepage.routes.HomePageController.startNewReturn().url)

 <ul>
 @draftReturns.map { draftReturn =>
  <li><a href="@{controllers.accounts.homepage.routes.HomePageController.resumeDraftReturn(draftReturn.id)}">@{draftReturn.id}</a></li>
 }
 </ul>

<div class="grid-row">
 <div class="column-two-thirds">
  @insetPanel(Html(messages("account.home.private-beta.guide.content", appConfig.cgtLegacyUrl)))
 </div>
</div>

<div class="grid-row">
 <table border="1">
  <th>@messages("account.totalLeftToPay")</th>
  <th>@totalLeftToPay</th>
  <th><a href="">@messages("account.make.payment.link")</a></th>
 </table>
 </div>

}
