@*
 * Copyright 2020 HM Revenue & Customs
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *@

@import play.api.i18n.Messages
@import play.twirl.api.Html

@import cats.instances.long._
@import cats.syntax.eq._
@import java.time.LocalDate
@import uk.gov.hmrc.cgtpropertydisposalsfrontend.controllers.returns.acquisitiondetails.routes
@import uk.gov.hmrc.cgtpropertydisposalsfrontend.models.returns.AcquisitionDetailsAnswers.CompleteAcquisitionDetailsAnswers
@import uk.gov.hmrc.cgtpropertydisposalsfrontend.models.LocalDateUtils
@import uk.gov.hmrc.cgtpropertydisposalsfrontend.models.finance.MoneyUtils
@import uk.gov.hmrc.cgtpropertydisposalsfrontend.models.returns.AcquisitionMethod

@this(
        cyaSection: uk.gov.hmrc.cgtpropertydisposalsfrontend.views.html.components.cya_section,
        cyaRow: uk.gov.hmrc.cgtpropertydisposalsfrontend.views.html.components.cya_row,
        cyaChange: uk.gov.hmrc.cgtpropertydisposalsfrontend.views.html.components.cya_change,
        addressDisplay: uk.gov.hmrc.cgtpropertydisposalsfrontend.views.html.components.address_display,
)

@(answers: CompleteAcquisitionDetailsAnswers, cutoffDate: LocalDate, isUk: Boolean, isRebasing: Boolean)(implicit messages: Messages)
@acquisitionMethodAndPriceTitle = @{
  answers.acquisitionMethod match {
    case AcquisitionMethod.Bought => (messages("returns.acquisitionMethod.Bought"), messages("acquisitionPriceBought.title"))
    case AcquisitionMethod.Inherited => (messages("returns.acquisitionMethod.Inherited"), messages("acquisitionPriceNotBought.title", LocalDateUtils.govDisplayFormat(answers.acquisitionDate.value)))
    case AcquisitionMethod.Gifted => (messages("returns.acquisitionMethod.Gifted"), messages("acquisitionPriceNotBought.title", LocalDateUtils.govDisplayFormat(answers.acquisitionDate.value)))
    case AcquisitionMethod.Other(value) => (value, messages("acquisitionPriceNotBought.title", LocalDateUtils.govDisplayFormat(answers.acquisitionDate.value)))
  }
}

@cyaSection() {
  @cyaRow(
    messages("acquisitionMethod.title"),
    Html(acquisitionMethodAndPriceTitle._1),
    Some(cyaChange(messages("acquisitionDetails.cyaChange.acquisitionMethod"), routes.AcquisitionDetailsController.acquisitionMethod().url)),
    "acquisitionMethod"
  )
  @cyaRow(
    messages("acquisitionDate.title"),
    Html(LocalDateUtils.govDisplayFormat(answers.acquisitionDate.value)),
    Some(cyaChange(messages("acquisitionDetails.cyaChange.acquisitionDate"), routes.AcquisitionDetailsController.acquisitionDate().url)),
    "acquisitionDate"
  )

@if((isUk && !isRebasing) || !isUk) {
@cyaRow(
    acquisitionMethodAndPriceTitle._2,
      Html(MoneyUtils.formatAmountOfMoneyWithPoundSign(answers.acquisitionPrice.inPounds())),
      Some(cyaChange(messages("acquisitionDetails.cyaChange.acquisitionPrice"), routes.AcquisitionDetailsController.acquisitionPrice().url)),
      "acquisitionPrice"
)
}

@if(isRebasing) {
  @answers.rebasedAcquisitionPrice.map{ rebasedValue =>
    @if(rebasedValue.value === 0L){
      @cyaRow(
        messages("acquisitionDetails.cyaLabel.rebased"),
        Html(messages("generic.no")),
        Some(cyaChange(messages("acquisitionDetails.cyaChange.rebasedAcquisitionPrice"), routes.AcquisitionDetailsController.rebasedAcquisitionPrice().url)),
        "rebasedAcquisitionPrice"
      )
    } else {
      @cyaRow(
        messages("acquisitionDetails.cyaLabel.rebasedValue", LocalDateUtils.govShortDisplayFormat(cutoffDate)),
        Html(MoneyUtils.formatAmountOfMoneyWithPoundSign(rebasedValue.inPounds())),
        Some(cyaChange(messages("acquisitionDetails.cyaChange.rebasedAcquisitionPrice"), routes.AcquisitionDetailsController.rebasedAcquisitionPrice().url)),
        "rebasedAcquisitionPrice-value"
      )
    }
  }
}
@if(!isUk && isRebasing) {
@if(answers.shouldUseRebase){
  @cyaRow(
    messages("shouldUseRebase.title", LocalDateUtils.govShortDisplayFormat(cutoffDate)),
    Html(messages("generic.yes")),
    Some(cyaChange(messages("acquisitionDetails.cyaChange.shouldUseRebase"), routes.AcquisitionDetailsController.shouldUseRebase().url)),
    "shouldRebase"
  )
} else {
  @cyaRow(
    messages("shouldUseRebase.title", LocalDateUtils.govShortDisplayFormat(cutoffDate)),
    Html(messages("generic.no")),
    Some(cyaChange(messages("acquisitionDetails.cyaChange.shouldUseRebase"), routes.AcquisitionDetailsController.shouldUseRebase().url)),
    "shouldRebase"
  )
}
}

@if(answers.improvementCosts.value === 0L){
@cyaRow(
messages("improvementCosts.title"),
Html(messages("generic.no")),
      Some(cyaChange(messages("acquisitionDetails.cyaChange.improvementCosts"), routes.AcquisitionDetailsController.improvementCosts().url)),
      "improvementCosts"
    )
  } else {
    @cyaRow(
      messages("improvementCosts.title"),
      Html(messages("generic.yes")),
      Some(cyaChange(messages("acquisitionDetails.cyaChange.improvementCosts"), routes.AcquisitionDetailsController.improvementCosts().url)),
      "improvementCosts"
    )
    @cyaRow(
      messages("acquisitionDetails.cyaLabel.improvementCostsValue"),
      Html(MoneyUtils.formatAmountOfMoneyWithPoundSign(answers.improvementCosts.inPounds())),
      Some(cyaChange(messages("acquisitionDetails.cyaChange.improvementCosts"), routes.AcquisitionDetailsController.improvementCosts().url)),
      "improvementCosts-value"
    )
  }
  @if(answers.acquisitionFees.value === 0L){
    @cyaRow(
      messages("acquisitionFees.title"),
      Html(messages("generic.no")),
      Some(cyaChange(messages("acquisitionDetails.cyaChange.acquisitionFees"), routes.AcquisitionDetailsController.acquisitionFees().url)),
      "acquisitionFees"
    )
  } else {
    @cyaRow(
      messages("acquisitionFees.title"),
      Html(messages("generic.yes")),
      Some(cyaChange(messages("acquisitionDetails.cyaChange.acquisitionFees"), routes.AcquisitionDetailsController.acquisitionFees().url)),
      "acquisitionFees"
    )
    @cyaRow(
      messages("acquisitionDetails.cyaLabel.acquisitionFeesValue"),
      Html(MoneyUtils.formatAmountOfMoneyWithPoundSign(answers.acquisitionFees.inPounds())),
      Some(cyaChange(messages("acquisitionDetails.cyaChange.acquisitionFees"), routes.AcquisitionDetailsController.acquisitionFees().url)),
      "acquisitionFees-value"
    )
  }
}